name: Stale Issues and PRs

on:
    pull_request:
        types: [opened, reopened, synchronize]
        branches: [main]
    schedule:
        - cron: "30 1 * * *" # Run daily at 1:30 AM UTC
    workflow_dispatch:

permissions:
    issues: write
    pull-requests: write

jobs:
    pr-sync-check:
        runs-on: ubuntu-latest
        if: github.event_name == 'pull_request'
        steps:
            - name: PR sync trigger acknowledged
              run: echo "PR synchronize trigger received for stale workflow."

    stale:
        runs-on: ubuntu-latest
        if: github.event_name != 'pull_request'
        steps:
            - uses: actions/stale@v9
              with:
                  stale-issue-message: >
                      This issue has been automatically marked as stale because it has not had
                      recent activity. It will be closed in 14 days if no further activity occurs.
                      If this issue is still relevant, please comment or update it.
                  stale-pr-message: >
                      This pull request has been automatically marked as stale because it has not had
                      recent activity. It will be closed in 14 days if no further activity occurs.
                      Please update or rebase if this PR is still needed.
                  close-issue-message: >
                      This issue has been closed due to inactivity. Feel free to reopen if still relevant.
                  close-pr-message: >
                      This pull request has been closed due to inactivity. Feel free to reopen if still needed.
                  days-before-stale: 60
                  days-before-close: 14
                  stale-issue-label: "stale"
                  stale-pr-label: "stale"
                  exempt-issue-labels: "pinned,security,help wanted,good first issue"
                  exempt-pr-labels: "pinned,security,work in progress"
                  remove-stale-when-updated: true
